[["PreProc","#!/usr/bin/env perl"],["","\n"],["Statement","use strict"],["",";\n"],["Statement","use warnings"],["",";\n"],["Statement","use "],["","Time::HiRes "],["String","'time'"],["",";\n"],["Statement","use "],["","List::Util "],["String","'sum'"],["",";\n"],["Statement","use "],["","IPC::System::Simple "],["String","'system'"],["",";\n"],["Statement","use autodie"],["",";\n"],["Statement","use "],["","Parse::BACKPAN::Packages;\n"],["Statement","use "],["","LWP::Simple;\n"],["Statement","use "],["","Archive::Tar;\n"],["Statement","use "],["","File::Slurp "],["String","'slurp'"],["",";\n\n"],["Statement","my"],[""," "],["Identifier","$backpan"],[""," = Parse::BACKPAN::Packages->new;\n"],["Statement","my"],[""," "],["Identifier","@cmops"],["","   = "],["Identifier","$backpan"],["","->distributions("],["String","'Class-MOP'"],["",");\n"],["Statement","my"],[""," "],["Identifier","@mooses"],["","  = "],["Identifier","$backpan"],["","->distributions("],["String","'Moose'"],["",");\n\n"],["Statement","my"],[""," "],["Identifier","$cmop_version"],[""," = "],["Number","0"],["",";\n"],["Statement","my"],[""," "],["Identifier","$cmop_dir"],["",";\n\n"],["Statement","my"],[""," "],["Identifier","$base"],[""," = "],["String","\"http://backpan.cpan.org/\""],["",";\n\n"],["Statement","my"],[""," "],["Identifier","%time"],["",";\n"],["Statement","my"],[""," "],["Identifier","%mem"],["",";\n\n"],["Statement","open"],[""," "],["Statement","my"],[""," "],["Identifier","$output"],["",", "],["String","\">\""],["",", "],["String","\"moose_bench.txt\""],["",";\n\n"],["Repeat","for"],[""," "],["Statement","my"],[""," "],["Identifier","$moose"],[""," ("],["Identifier","@mooses"],["",") {\n    "],["Statement","my"],[""," "],["Identifier","$moose_dir"],[""," = build("],["Identifier","$moose"],["",");\n\n    "],["Comment","# Find the CMOP dependency"],["","\n    "],["Statement","my"],[""," "],["Identifier","$makefile"],[""," = slurp("],["String","\""],["Identifier","$moose_dir"],["String","/Makefile.PL\""],["",");\n    "],["Statement","my"],[""," ("],["Identifier","$cmop_dep"],["",") = "],["Identifier","$makefile"],[""," =~ "],["Statement","/"],["String","Class::MOP"],["Special",".*?([0-9._]+)"],["Statement","/"],["","\n        "],["Operator","or"],[""," "],["Statement","die"],[""," "],["String","\"Unable to find Class::MOP version dependency in "],["Identifier","$moose_dir"],["String","/Makefile.PL\""],["",";\n\n    "],["Comment","# typo?"],["","\n    "],["Identifier","$cmop_dep"],[""," = "],["String","'0.64_07'"],[""," "],["Conditional","if"],[""," "],["Identifier","$cmop_dep"],[""," "],["Operator","eq"],[""," "],["String","'0.6407'"],["",";\n\n    "],["Comment","# nonexistent dev releases?"],["","\n    "],["Identifier","$cmop_dep"],[""," = "],["String","'0.79'"],[""," "],["Conditional","if"],[""," "],["Identifier","$cmop_dep"],[""," "],["Operator","eq"],[""," "],["String","'0.78_02'"],["",";\n    "],["Identifier","$cmop_dep"],[""," = "],["String","'0.83'"],[""," "],["Conditional","if"],[""," "],["Identifier","$cmop_dep"],[""," "],["Operator","eq"],[""," "],["String","'0.82_01'"],["",";\n\n    bump_cmop("],["Identifier","$cmop_dep"],["",", "],["Identifier","$moose"],["",");\n\n    "],["Statement","warn"],[""," "],["String","\"Building "],["Identifier","$moose_dir"],["String","\""],["",";\n    "],["Statement","eval"],[""," {\n        "],["Statement","system"],["","("],["String","\"(cd '"],["Identifier","$moose_dir"],["String","' && '"],["Identifier","$^X"],["String","' '-I"],["Identifier","$cmop_dir"],["String","/lib' Makefile.PL && make && sudo make install) >/dev/null\""],["",");\n\n        "],["Statement","my"],[""," "],["Identifier","@times"],["",";\n        "],["Repeat","for"],[""," ("],["Number","1"],[""," .. "],["Number","5"],["",") {\n            "],["Statement","my"],[""," "],["Identifier","$start"],[""," = "],["Statement","time"],["",";\n            "],["Statement","system"],["","(\n                "],["Identifier","$^X"],["",",\n                "],["String","\"-I"],["Identifier","$moose_dir"],["String","/lib\""],["",",\n                "],["String","\"-I"],["Identifier","$cmop_dir"],["String","/lib\""],["",",\n                "],["String","'-e'"],["",", "],["String","'package Class; use Moose;'"],["",",\n            );\n            "],["Statement","push"],[""," "],["Identifier","@times"],["",", "],["Statement","time"],[""," - "],["Identifier","$start"],["",";\n        }\n\n        "],["Identifier","$time{$moose"],["","->version"],["Identifier","}"],[""," = sum("],["Identifier","@times"],["",") / "],["Identifier","@times"],["",";\n        "],["Identifier","$mem{$moose"],["","->version"],["Identifier","}"],[""," = "],["String","qx["],["Identifier","$^X"],["String"," -I"],["Identifier","$moose_dir"],["String","/lib -I"],["Identifier","$cmop_dir"],["String","/lib -MGTop -e 'my ("],["Special","\\$"],["String","gtop, "],["Special","\\$"],["String","before); BEGIN { "],["Special","\\$"],["String","gtop = GTop->new; "],["Special","\\$"],["String","before = "],["Special","\\$"],["String","gtop->proc_mem("],["Special","\\$\\$"],["String",")->size; } package Class; use Moose; print "],["Special","\\$"],["String","gtop->proc_mem("],["Special","\\$\\$"],["String",")->size - "],["Special","\\$"],["String","before']"],["",";\n        "],["Statement","my"],[""," "],["Identifier","$line"],[""," = "],["Statement","sprintf"],[""," "],["String","\"%7s: %0.4f (%s), %d bytes"],["Special","\\n"],["String","\""],["",",\n            "],["Identifier","$moose"],["","->version,\n            "],["Identifier","$time{$moose"],["","->version"],["Identifier","}"],["",",\n            "],["Statement","join"],["","("],["String","', '"],["",", "],["Statement","map"],[""," "],["Statement","{"],[""," "],["Statement","sprintf"],[""," "],["String","\"%0.4f\""],["",", "],["Identifier","$_"],[""," "],["Statement","}"],[""," "],["Identifier","@times"],["","),\n            "],["Identifier","$mem{$moose"],["","->version"],["Identifier","}"],["",";\n        "],["Statement","print"],[""," "],["Identifier","$output"],[""," "],["Identifier","$line"],["",";\n    };\n    "],["Statement","warn"],[""," "],["Identifier","$@"],[""," "],["Conditional","if"],[""," "],["Identifier","$@"],["",";\n}\n\n"],["Statement","require"],[""," Chart::Clicker;\n"],["Statement","require"],[""," Chart::Clicker::Data::Series;\n"],["Statement","require"],[""," Chart::Clicker::Data::DataSet;\n"],["Statement","my"],[""," "],["Identifier","@versions"],[""," = "],["Statement","sort"],[""," "],["Statement","keys"],[""," "],["Identifier","%time"],["",";\n"],["Statement","my"],[""," "],["Identifier","@startups"],[""," = "],["Statement","map"],[""," "],["Statement","{"],["","     "],["Identifier","$time{$_}"],["","        "],["Statement","}"],[""," "],["Identifier","@versions"],["",";\n"],["Statement","my"],[""," "],["Identifier","@memories"],[""," = "],["Statement","map"],[""," "],["Statement","{"],[""," "],["Statement","int"],["","("],["Identifier","$mem{$_}"],[""," / "],["Number","1024"],["",") "],["Statement","}"],[""," "],["Identifier","@versions"],["",";\n"],["Statement","my"],[""," "],["Identifier","@keys"],["","     = ("],["Float","0."],["","."],["Identifier","$#versions"],["",");\n"],["Statement","my"],[""," "],["Identifier","$cc"],[""," = Chart::Clicker->new("],["String","width"],[""," => "],["Number","900"],["",", "],["String","height"],[""," => "],["Number","400"],["",");\n"],["Statement","my"],[""," "],["Identifier","$sutime"],[""," = Chart::Clicker::Data::Series->new(\n    "],["String","values"],[""," => \\"],["Identifier","@startups"],["",",\n    "],["String","keys"],["","   => \\"],["Identifier","@keys"],["",",\n    "],["String","name"],["","   => "],["String","'Startup Time'"],["",",\n);\n"],["Statement","my"],[""," "],["Identifier","$def"],[""," = "],["Identifier","$cc"],["","->get_context("],["String","'default'"],["",");\n"],["Identifier","$def"],["","->domain_axis->tick_values(\\"],["Identifier","@keys"],["",");\n"],["Identifier","$def"],["","->domain_axis->tick_labels(\\"],["Identifier","@versions"],["",");\n"],["Identifier","$def"],["","->domain_axis->tick_label_angle("],["Float","1.57"],["",");\n"],["Identifier","$def"],["","->domain_axis->tick_font->size("],["Number","8"],["",");\n"],["Identifier","$def"],["","->range_axis->fudge_amount("],["String","'0.05'"],["",");\n\n"],["Statement","my"],[""," "],["Identifier","$context"],[""," = Chart::Clicker::Context->new("],["String","name"],[""," => "],["String","'memory'"],["",");\n"],["Identifier","$context"],["","->range_axis->tick_values(["],["String","qw(1024 2048 3072 4096 5120)"],["","]);\n"],["Identifier","$context"],["","->range_axis->"],["Statement","format"],["","("],["String","'%d'"],["",");\n"],["Identifier","$context"],["","->domain_axis->hidden("],["Number","1"],["",");\n"],["Identifier","$context"],["","->range_axis->fudge_amount("],["String","'0.05'"],["",");\n"],["Identifier","$cc"],["","->add_to_contexts("],["Identifier","$context"],["",");\n\n"],["Statement","my"],[""," "],["Identifier","$musage"],[""," = Chart::Clicker::Data::Series->new(\n    "],["String","values"],[""," => \\"],["Identifier","@memories"],["",",\n    "],["String","keys"],[""," => \\"],["Identifier","@keys"],["",",\n    "],["String","name"],[""," => "],["String","'Memory Usage (kb)'"],["","\n);\n\n"],["Statement","my"],[""," "],["Identifier","$ds1"],[""," = Chart::Clicker::Data::DataSet->new("],["String","series"],[""," => [ "],["Identifier","$sutime"],[""," ]);\n"],["Statement","my"],[""," "],["Identifier","$ds2"],[""," = Chart::Clicker::Data::DataSet->new("],["String","series"],[""," => [ "],["Identifier","$musage"],[""," ]);\n"],["Identifier","$ds2"],["","->context("],["String","'memory'"],["",");\n\n"],["Identifier","$cc"],["","->add_to_datasets("],["Identifier","$ds1"],["",");\n"],["Identifier","$cc"],["","->add_to_datasets("],["Identifier","$ds2"],["",");\n"],["Identifier","$cc"],["","->write_output("],["String","'moose_bench.png'"],["",");\n\n"],["Keyword","sub "],["Function","bump_cmop "],["","{\n    "],["Statement","my"],[""," "],["Identifier","$expected"],[""," = "],["Statement","shift"],["",";\n    "],["Statement","my"],[""," "],["Identifier","$moose"],[""," = "],["Statement","shift"],["",";\n\n    "],["Statement","return"],[""," "],["Identifier","$cmop_dir"],[""," "],["Conditional","if"],[""," "],["Identifier","$cmop_version"],[""," "],["Operator","eq"],[""," "],["Identifier","$expected"],["",";\n\n    "],["Statement","my"],[""," "],["Identifier","@orig_cmops"],[""," = "],["Identifier","@cmops"],["",";\n    "],["Statement","shift"],[""," "],["Identifier","@cmops"],[""," "],["Repeat","until"],[""," !"],["Identifier","@cmops"],[""," || "],["Identifier","$cmops["],["Number","0"],["Identifier","]"],["","->version "],["Operator","eq"],[""," "],["Identifier","$expected"],["",";\n\n    "],["Statement","die"],[""," "],["String","\"Ran out of cmops, wanted "],["Identifier","$expected"],["String"," for \""],["","\n        . "],["Identifier","$moose"],["","->distvname\n        . "],["String","\" (had \""],[""," . "],["Statement","join"],["","("],["String","', '"],["",", "],["Statement","map"],[""," "],["Statement","{"],[""," "],["Identifier","$_"],["","->version "],["Statement","}"],[""," "],["Identifier","@orig_cmops"],["",") . "],["String","\")\""],["","\n            "],["Conditional","if"],[""," !"],["Identifier","@cmops"],["",";\n\n    "],["Identifier","$cmop_version"],[""," = "],["Identifier","$cmops["],["Number","0"],["Identifier","]"],["","->version;\n    "],["Identifier","$cmop_dir"],[""," = build("],["Identifier","$cmops["],["Number","0"],["Identifier","]"],["",");\n\n    "],["Statement","warn"],[""," "],["String","\"Building "],["Identifier","$cmop_dir"],["String","\""],["",";\n    "],["Statement","system"],["","("],["String","\"(cd '"],["Identifier","$cmop_dir"],["String","' && '"],["Identifier","$^X"],["String","' Makefile.PL && make && sudo make install) >/dev/null\""],["",");\n\n    "],["Statement","return"],[""," "],["Identifier","$cmop_dir"],["",";\n}\n\n"],["Keyword","sub "],["Function","build "],["","{\n    "],["Statement","my"],[""," "],["Identifier","$dist"],[""," = "],["Statement","shift"],["",";\n    "],["Statement","my"],[""," "],["Identifier","$distvname"],[""," = "],["Identifier","$dist"],["","->distvname;\n    "],["Statement","return"],[""," "],["Identifier","$distvname"],[""," "],["Conditional","if"],[""," "],["Statement","-d"],[""," "],["Identifier","$distvname"],["",";\n\n    "],["Statement","warn"],[""," "],["String","\"Downloading "],["Identifier","$distvname"],["String","\""],["",";\n    "],["Statement","my"],[""," "],["Identifier","$tarball"],[""," = get("],["Identifier","$base"],[""," . "],["Identifier","$dist"],["","->prefix);\n    "],["Statement","open"],[""," "],["Statement","my"],[""," "],["Identifier","$handle"],["",", "],["String","'<'"],["",", \\"],["Identifier","$tarball"],["",";\n\n    "],["Statement","my"],[""," "],["Identifier","$tar"],[""," = Archive::Tar->new;\n    "],["Identifier","$tar"],["","->"],["Statement","read"],["","("],["Identifier","$handle"],["",");\n    "],["Identifier","$tar"],["","->extract;\n\n    "],["Statement","my"],[""," ("],["Identifier","$arbitrary_file"],["",") = "],["Identifier","$tar"],["","->list_files;\n    ("],["Statement","my"],[""," "],["Identifier","$directory"],[""," = "],["Identifier","$arbitrary_file"],["",") =~ "],["Statement","s{"],["String","/"],["Special",".*"],["Statement","}{}"],["",";\n    "],["Statement","return"],[""," "],["Identifier","$directory"],["",";\n}\n\n"]]